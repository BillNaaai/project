<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>View Item - E-Shop</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="navigation-container"></div>
  <script src="navigation.js"></script>

  <div class="container my-5">
    <div id="item-container" class="row">
      <div class="col-12 text-center">
        <div class="alert alert-info">Loading item details...</div>
      </div>
    </div>
  </div>

  <div id="footer-container"></div>
  <script src="footer.js"></script>

  <script>
    function getItemIdFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    function addToCart(item) {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.push({
        id: item.id,
        title: item.title,
        price: parseFloat(item.price),
        quantity: 1,
        seller_id: item.user_id
      });
      localStorage.setItem('cart', JSON.stringify(cart));
      alert("Item added to cart!");
    }

    async function loadItemDetails() {
      const itemId = getItemIdFromURL();
      const container = document.getElementById("item-container");

      if (!itemId) {
        container.innerHTML = `<div class="alert alert-danger">Invalid item ID</div>`;
        return;
      }

      try {
        const response = await fetch(`get_item.php?id=${itemId}`);
        const item = await response.json();

        if (item.error) {
          container.innerHTML = `<div class="alert alert-danger">${item.error}</div>`;
          return;
        }

        container.innerHTML = `
          <div class="col-md-6">
            <img src="${item.image_url || 'https://via.placeholder.com/400x300?text=No+Image'}" class="img-fluid rounded shadow" alt="${item.title}" />
          </div>
          <div class="col-md-6">
            <h2>${item.title}</h2>
            <p class="text-muted">Category: ${item.category}</p>
            <h4 class="text-success">R${parseFloat(item.price).toFixed(2)}</h4>
            <p>${item.description}</p>

            <hr />
            <p><strong>Seller:</strong> ${item.first_name} ${item.last_name}</p>
            <p><strong>Contact:</strong> <a href="mailto:${item.email}">${item.email}</a></p>

            <button class="btn btn-primary mt-3" onclick='addToCart(${JSON.stringify(item)})'>Add to Cart</button>
          </div>
        `;
      } catch (error) {
        console.error(error);
        container.innerHTML = `<div class="alert alert-danger">Failed to load item details.</div>`;
      }
    }

    document.addEventListener("DOMContentLoaded", loadItemDetails);
  </script>
</body>
</html>
